pro venice_test,tbreak,z,eiso52,theta,egam
  
;  tbreak=[2.9,1.0,14.5,4.1,13.9,12,43,16,29,81,15,28,13,52,23,29,46,15]
  tbreak=[2.8,1.0,14.5,4.1,9.4,1.3,9,71,16,15,125,13,9.3e-4,19,13,52,20,29,42,15]

  t=2.5
  z=[1.949,5.3,2.612,0.546,t,0.125,2.9,0.654,2.345,4.048,0.54,1.26,1.26,t,t,t,t,t,t,t]
  t=10.
  eiso52=[3.3,18,83,0.15,t,0.25,35,0.12,5.,5.8,1.6,100,100,t,t,t,t,t,t,t]
  eiso53=eiso52/10.
  theta=dblarr(n_elements(tbreak))
  
  for i=0,n_elements(tbreak)-1 do begin
     if z[i] ne 2.5 then $
        j=jet_angle(tbreak[i],z=z[i],eiso=eiso53[i]) $
     else j=jet_angle(tbreak[i])
     theta[i]=j
  endfor
  
  egam=alog10(eiso52*1d52*(1.-cos(theta*!dtor)))

  
  print,1./6.*(tbreak/(1.+z))^(3./8.)*(0.2/eiso52)^(1./8.)*!radeg
  print
  print,0.161*(tbreak/(1.+z))^(3./8.)*(0.2/eiso52)^(1./8.)*!radeg
  print
  print,0.057*tbreak^(3./8.)*((1.+z)/2.)^(-3./8.)*(0.2*eiso53)^(-1./8.)*(1/0.1)^(1./8.)*!radeg
  
  w=where(eiso52 eq t)
  egam[w]=-1
  z[w]=-1
  eiso52[w]=-1
  print
  print,'table'
  colprint,fix(tbreak),z,eiso52,theta,egam
  
  stop
end

function jet_angle,tbreak,z=z,eiso=eiso,eta=eta,silent=silent
;;; theta j calculation from Burrows et al. (2006) (Venice proceedings)
  ;;TBREAK MUST BE IN DAYS!!!!

;  if tbreak gt 500 then tbreak=tbreak/86400d

  mult=' *n^(1/8)'
  if n_elements(z) eq 0 or n_elements(eiso) eq 0 then mult=' *xi'
  if n_elements(z) eq 0 then z=2.5
  if n_elements(eiso) eq 0 then eiso=1d53
  if eiso gt 1d40 then eiso=eiso/1d53
;const=0.114
  const=0.064

  if n_elements(eta) eq 0 then eta=0.2

  n=1d
  xi=(3.5/(1.+z))^(3./8.)*(eta/0.2)^(1./8.)*(n/eiso)^(1./8.)

  theta=const*xi*tbreak^(3./8.)*!radeg

  if not keyword_set(silent) then print,'Theta_j = '+sigfig(theta,3)+mult

  return,theta
end
